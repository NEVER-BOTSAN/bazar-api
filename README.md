Веб сервер "bazar-api"

Почему именно? "Bazar" ? Все просто,  базар — это место, где собрано много магазинов с разными товарами, и информацию о них нужно где-то хранить и контрлировать. Проект показывает, как организовать данные о магазинах и категориях в одном месте, и стал для меня отличной возможностью продемонстрировать навыки работы с GO, REST API, Docker и PostgreSQL.

bazar-api — это веб-сервер, созданный для управления магазинами и их категориями. Этот REST API позволяет добавлять, редактировать, просматривать и удалять данные о магазинах и категориях, а также поддерживает связь между ними.

Проект реализован на языке программирования Go с использованием PostgreSQL в качестве базы данных, работающей в контейнере Docker. Для проекта также соблюдена луковая архитектура (onion architecture), что позволяет организовать структуру компонентов с разделением ответственности, повысить модульность и тестируемость кода, а также снизить зависимость компонентов приложения друг от друга.

Сервис bazar-api предоставляет удобный способ работы с данными магазинов и категорий через HTTP-запросы, что позволяет легко интегрировать его с фронтенд-приложениями или другими сервисами. База данных PostgreSQL управляется с помощью Docker, обеспечивая гибкость и лёгкость развертывания.


Установка Docker и PostgreSQL
Установка Docker:

Перейдите на официальную страницу Docker и скачайте Docker Desktop, следуя инструкциям по установке для вашей операционной системы (Windows, macOS, или Linux).
После установки Docker запустите Docker Desktop и убедитесь, что сервис запущен. Для проверки выполните команду:
bash
Копировать код
docker --version
Это отобразит версию Docker, если он установлен корректно.
Создание и запуск контейнера PostgreSQL:

Выполните следующую команду для создания и запуска контейнера с PostgreSQL:
bash
Копировать код
docker run --name bazar-postgres -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=1234 -e POSTGRES_DB=shop_db -p 5432:5432 -d postgres
Здесь:

После запуска контейнера можно подключиться к базе данных с помощью любой программы для работы с PostgreSQL или используя команду psql.

Если контейнер был остановлен, его нужно запустить снова командой:

bash
Копировать код
docker start bazar-postgres

3. Взаимодействие с проектом

После запуска сервиса bazar-api взаимодействие с ним осуществляется через REST API, доступный по адресу http://localhost:<порт>/api/v1. API позволяет управлять магазинами и их категориями с помощью следующих HTTP-методов:

GET: Получение данных. Например, можно получить список всех магазинов, категорий или информацию о конкретном магазине.
POST: Создание новых записей. Например, добавление нового магазина с привязкой к категориям.
PATCH: Частичное обновление данных. Этот метод позволяет обновить только те поля, которые были переданы в запросе. Например, обновление имени магазина или его привязки к новым категориям.
PUT: Полное обновление данных. Этот метод позволяет заменить все данные магазина, включая его категорию, если это необходимо.
DELETE: Удаление данных. Например, удаление магазина и его привязки к категориям.
Также в API реализована пагинация для получения больших объемов данных. Для этого запросы могут включать параметры page и limit, которые позволяют ограничить количество возвращаемых объектов и упростить работу с большими коллекциями.

Пример запроса с пагинацией для получения магазинов:

http
Копировать код
GET /api/v1/shops?page=1&limit=10
Такой запрос вернет список магазинов, начиная с первой страницы и ограничивая его 10 записями.




4. Реализация REST API

REST API для bazar-api реализован с соблюдением стандартов HTTP и предоставляет несколько конечных точек для работы с магазинами и категориями. Все запросы отправляются по пути http://localhost:8080/api/v1.

Конечные точки
GET /api/v1/shops?page=<номер страницы>&limit=<количество записей на странице> — получение списка всех магазинов с поддержкой пагинации.
GET /api/v1/categories?page=<номер страницы>&limit=<количество записей на странице> — получение списка всех категорий с поддержкой пагинации.
POST /api/v1/shops — создание нового магазина с возможностью привязки к одной или нескольким категориям.
PATCH /api/v1/shops?id=<shop_id> — частичное обновление данных магазина, включая добавление или изменение категорий.
DELETE /api/v1/shops?id=<shop_id> — удаление магазина из базы данных.
Принципы работы
Создание новых объектов и связь магазина с категориями: при создании магазина через POST /api/v1/shops, можно указать связанные категории, чтобы сразу привязать его к нужным категориям.
Пагинация данных: параметры page и limit позволяют гибко управлять объемом данных, получаемых за один запрос, что особенно удобно при большом объеме информации.
Обновление данных с помощью PATCH запросов: запрос PATCH /api/v1/shops?id=<shop_id> позволяет обновить основные данные магазина и изменить привязки категорий.
Удаление объектов: запрос DELETE /api/v1/shops?id=<shop_id> позволяет полностью удалить магазин и его привязки к категориям из базы данных.


GET /api/v1/shops — Получение списка магазинов
Описание: Этот запрос возвращает список всех магазинов в системе, включая категории, к которым они привязаны. Если магазин не привязан ни к одной категории, поле categories будет пустым.

Параметры запроса:

page (опционально): Номер страницы, начиная с 1.
limit (опционально): Количество магазинов, отображаемых на одной странице.
Пример запроса для получения всех магазинов:

http
Копировать код
GET http://localhost:8080/api/v1/shops
Пример запроса с использованием параметров page и limit:

http
Копировать код
GET http://localhost:8080/api/v1/shops?page=1&limit=10
Пример ответа:

json
Копировать код
[
    {
        "shop": {
            "id": 1,
            "name": "Магазин 1",
            "image": "image1.jpg",
            "price": 100,
            "description": "Описание магазина 1"
        },
        "categories": []
    },
    {
        "shop": {
            "id": 2,
            "name": "Магазин 2",
            "image": "image2.jpg",
            "price": 200,
            "description": "Описание магазина 2"
        },
        "categories": [
            "Категория A"
        ]
    },
    {
        "shop": {
            "id": 3,
            "name": "Магазин 3",
            "image": "image3.jpg",
            "price": 300,
            "description": "Описание магазина 3"
        },
        "categories": [
            "Категория B",
            "Категория C"
        ]
    }
]
Примечание: Поле categories содержит массив с названиями категорий, к которым принадлежит магазин. Если у магазина нет категорий, это поле будет пустым ("categories": []).

GET /api/v1/categories — Получение списка категорий
Описание: Этот запрос возвращает список всех категорий, доступных в системе.

Пример запроса:

http
Копировать код
GET http://localhost:8080/api/v1/categories
Пример ответа:

json
Копировать код
[
    {
        "id": 1,
        "name": "Категория A"
    },
    {
        "id": 2,
        "name": "Категория B"
    },
    {
        "id": 3,
        "name": "Категория C"
    }
]
Примечание: Каждый объект в ответе представляет собой категорию с полями id (уникальный идентификатор категории) и name (название категории).


POST /api/v1/shops — Создание нового магазина
Описание: Данный запрос создает новый магазин в системе и связывает его с категориями, если они указаны.

Пример запроса:

http
Копировать код
POST http://localhost:8080/api/v1/shops

Тело запроса:

json
Копировать код
{
    "shop": {
        "name": "Новый магазин",
        "image": "image_new.jpeg",
        "price": 200,
        "description": "Описание нового магазина"
    },
    "categories": [1, 2]
}
Поле shop содержит данные о магазине (название, изображение, цена и описание).
Поле categories — массив идентификаторов категорий, к которым будет привязан магазин.
Пример успешного ответа:

Копировать код
Магазин успешно добавлен!
Примечание:

Если указан пустой массив categories, магазин будет создан без привязки к категориям.
Если категории не существуют, сервер вернет ошибку при добавлении.

DELETE /api/v1/shops?id=<shop_id> — Удаление магазина
Описание: Этот запрос удаляет магазин по его идентификатору (shop_id) и убирает все связи магазина с категориями.

Пример запроса:

http
Копировать код
DELETE http://localhost:8080/api/v1/shops?id=1
Параметр id — идентификатор магазина, который нужно удалить.
Пример успешного ответа:

Копировать код
Магазин успешно удален!
Примечание:

Если магазин с указанным id не существует, сервер вернет ошибку.

PUT /api/v1/shops?id=<shop_id> — Полное обновление данных магазина
Описание: Этот запрос выполняет полное обновление данных магазина с указанным shop_id, позволяя обновить его название, изображение, цену, описание, а также изменить привязанные к нему категории.

Пример запроса:

http
Копировать код
PUT http://localhost:8080/api/v1/shops?id=2
Content-Type: application/json

{
    "shop": {
        "name": "Обновленный магазин",
        "image": "обновленное_изображение.jpeg",
        "price": 500,
        "description": "Полностью обновленное описание"
    },
    "categories": ["Категория 1", "Категория 4"]
}
Параметр id — идентификатор магазина, данные которого нужно обновить.
В теле запроса отправляются:
Объект shop, содержащий обновленные данные магазина (например, name, image, price, description).
Массив categories, включающий список категорий, к которым будет привязан магазин.
Пример успешного ответа:

Копировать код
Магазин успешно обновлен!
Примечание:

Если магазин с указанным id не существует, сервер вернет ошибку.
Если поле categories пустое, то привязка категорий магазина будет очищена.

PATCH /api/v1/shops?id=<shop_id> — Частичное обновление данных магазина
Описание: Этот запрос выполняет частичное обновление данных магазина с указанным shop_id, позволяя обновить только те поля, которые присутствуют в теле запроса, а также изменить привязанные категории.

Пример запроса:

http
Копировать код
PATCH http://localhost:8080/api/v1/shops?id=3


{
    "shop": {
        "name": "Частично обновленный магазин",
        "price": 450
    },
    "categories": ["Категория 2"]
}
Параметр id — идентификатор магазина, данные которого нужно обновить.
В теле запроса отправляются:
Объект shop, содержащий поля, которые нужно обновить. Например, можно обновить только name и price, оставив остальные поля без изменений.
Массив categories, включающий новые привязки к категориям (если передан).
Пример успешного ответа:

Копировать код
Магазин успешно обновлен!
Примечание:

Если поле categories не указано, текущие категории магазина останутся без изменений.
Если categories передано как пустой массив, привязки к категориям будут удалены.

Чтобы поменять только категорию,можно отправить в теле запроса только массив с id необходимых категорий. Например:  
  {

        "categories": [
            1,2
        ]
    }
Пример успешного ответа:

Копировать код
Магазин успешно обновлен!








