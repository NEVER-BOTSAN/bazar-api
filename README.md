# Веб сервер "bazar-api"

## Почему именно "Bazar"?

Все просто: базар — это место, где собрано много магазинов с разными товарами, и информацию о них нужно где-то хранить и контролировать. Проект показывает, как организовать данные о магазинах и категориях в одном месте, и стал для меня отличной возможностью продемонстрировать навыки работы с **GO, REST API, Docker и PostgreSQL**.

## Описание проекта

**bazar-api** — это веб-сервер, созданный для управления магазинами и их категориями. Этот **REST API ** позволяет добавлять, редактировать, просматривать и удалять данные о магазинах и категориях, а также поддерживает связь между ними.

Проект реализован на языке программирования Go с использованием **PostgreSQL** в качестве базы данных, работающей в контейнере Docker. Для проекта также соблюдена луковая архитектура (onion architecture), что позволяет организовать структуру компонентов с разделением ответственности, повысить модульность и тестируемость кода, а также снизить зависимость компонентов приложения друг от друга.

Сервис **bazar-api** предоставляет удобный способ работы с данными магазинов и категорий через HTTP-запросы, что позволяет легко интегрировать его с фронтенд-приложениями или другими сервисами. База данных **PostgreSQL** управляется с помощью Docker, обеспечивая гибкость и лёгкость развертывания.

## Установка Docker и PostgreSQL



1. Перейдите на официальную страницу Docker и скачайте Docker Desktop, следуя инструкциям по установке для вашей операционной системы (Windows, macOS, или Linux).
2. После установки Docker запустите Docker Desktop и убедитесь, что сервис запущен. Для проверки выполните команду:

   ```bash
   docker --version
Это отобразит версию Docker, если он установлен корректно.

3. Создание и запуск контейнера PostgreSQL:
Выполните следующую команду для создания и запуска контейнера с PostgreSQL:

```PostgreSQL
docker run --name bazar-postgres -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=1234 -e POSTGRES_DB=shop_db -p 5432:5432 -d postgres
```

4. После запуска контейнера можно подключиться к базе данных с помощью любой программы для работы с PostgreSQL или используя команду psql.

Если контейнер был остановлен, его нужно запустить снова командой:

```PostgreSQL
docker start bazar-postgres
```
## Структура магазина
У каждого магазина есть свой id , наименование, фото , стоимость , описание. Все эти характеристики образуют собой структуру Shop:
```go
type Shop struct {
	ID          int    `json:"id"`
	Name        string `json:"name"`
	Image       string `json:"image"`
	Price       int    `json:"price"`
	Description string `json:"description"`
} 
```
Также для распределения магазинов есть категории , которые имеют следующую структуру:
```go 
type Category struct {
	ID   int    `json:"id"`
	Name string `json:"name"`
}
```
Для удобства отображения того , какой магазин к какой категории принадлежит , используется следующая структура: 
```go
type ShopWithCategories struct {
	Shop        Shop     `json:"shop"`
	CategoryIDs []string `json:"categories"`
}
```
Магазин , который имеет все характеристики и при этом принадлежит нескольким категориям в JSON выглядит так:
 ```json
  {
     "shop": {
            "id": 3,
            "name": "Магазин 3",
            "image": "картинка3.jpeg",
            "price": 300,
            "description": ""
        },
     "categories": [
            "Категория 1",
            "Категория 3"
        ]
    }
```
## Взаимодействие с проектом


API позволяет управлять магазинами и их категориями с помощью следующих HTTP-методов:

+ GET: Получение данных. Например, можно получить список всех магазинов, категорий или информацию о конкретном магазине.
+ POST: Создание новых записей. Например, добавление нового магазина с привязкой к категориям.
+ PATCH: Частичное обновление данных. Этот метод позволяет обновить только те поля, которые были переданы в запросе. Например, обновление имени магазина или его привязки к новым категориям.
+ PUT: Полное обновление данных. Этот метод позволяет заменить все данные магазина, включая его категорию, если это необходимо.
+ DELETE: Удаление данных. Например, удаление магазина и его привязки к категориям.

Также в API реализована пагинация для получения больших объемов данных. Для этого запросы могут включать параметры page и limit, которые позволяют ограничить количество возвращаемых объектов и упростить работу с большими коллекциями.

Пример запроса с пагинацией для получения магазинов:

>GET 
>>/api/v1/shops?page=1&limit=10


Такой запрос вернет список магазинов, начиная с первой страницы и ограничивая его 10 записями.Данные параметры стоят по умолчанию.

## Реализация REST API
**REST API** для **bazar-api** реализован с соблюдением стандартов HTTP и предоставляет несколько конечных точек для работы с магазинами и категориями. Все запросы отправляются по пути :
```
http://localhost:8080/api/v1
```

Конечные точки:
+ GET /api/v1/shops?page=<номер страницы>&limit=<количество записей на странице> — получение списка всех магазинов с поддержкой пагинации.
+ GET /api/v1/categories?page=<номер страницы>&limit=<количество записей на странице> — получение списка всех категорий с поддержкой пагинации.
+ POST /api/v1/shops — создание нового магазина с возможностью привязки к одной или нескольким категориям.
+ PATCH /api/v1/shops?id=<shop_id> — частичное обновление данных магазина, включая добавление или изменение категорий.
+ DELETE /api/v1/shops?id=<shop_id> — удаление магазина из базы данных.


## GET /api/v1/shops — Получение списка магазинов
 Этот запрос возвращает список всех магазинов в системе, включая категории, к которым они привязаны. Если магазин не привязан ни к одной категории, поле categories будет пустым.

Параметры запроса:
+ page (опционально): Номер страницы, начиная с 1.
+ limit (опционально): Количество магазинов, отображаемых на одной странице.
Пример запроса:


>GET
>>http://localhost:8080/api/v1/shops

Пример ответа:

```json

[
    {
        "shop": {
            "id": 1,
            "name": "Магазин 1",
            "image": "image1.jpg",
            "price": 100,
            "description": "Описание магазина 1"
        },
        "categories": []
    },
    {
        "shop": {
            "id": 2,
            "name": "Магазин 2",
            "image": "image2.jpg",
            "price": 200,
            "description": "Описание магазина 2"
        },
        "categories": [
            "Категория A"
        ]
    },
    {
        "shop": {
            "id": 3,
            "name": "Магазин 3",
            "image": "image3.jpg",
            "price": 300,
            "description": "Описание магазина 3"
        },
        "categories": [
            "Категория B",
            "Категория C"
        ]
    }
]
```
Также можно запросить список категорий , находящихся в БД.Пример запроса:
>GET
>>http://localhost:8080/api/v1/categories


Пример ответа:

```json

[
    {
        "id": 1,
        "name": "Категория A"
    },
    {
        "id": 2,
        "name": "Категория B"
    },
    {
        "id": 3,
        "name": "Категория C"
    }
]
```
## POST /api/v1/shops — Создание нового магазина
Описание: Данный запрос создает новый магазин в системе и связывает его с категориями, если они указаны.

Пример запроса:


>POST
>>http://localhost:8080/api/v1/shops

Тело запроса:


```json
{
    "shop": {
        "name": "Новый магазин",
        "image": "image_new.jpeg",
        "price": 200,
        "description": "Описание нового магазина"
    },
    "categories": [1, 2]
}
```
Пример успешного ответа:

>Магазин успешно добавлен!
## DELETE /api/v1/shops?id=<shop_id> — Удаление магазина
Описание: Этот запрос удаляет магазин по его идентификатору <shop_id> и убирает все связи магазина с категориями.

Пример запроса:

>DELETE
 >>http://localhost:8080/api/v1/shops?id=1

Пример успешного ответа:

>Магазин успешно удален!
## PUT /api/v1/shops?id=<shop_id> — Полное обновление данных магазина
Описание: Этот запрос выполняет полное обновление данных магазина с указанным <shop_id>, позволяя обновить его название, изображение, цену, описание и категории.

Пример запроса:


>PUT
>>http://localhost:8080/api/v1/shops?id=1

Тело запроса:

```json
{
    "shop": {
        "name": "Обновленный магазин",
        "image": "image_updated.jpeg",
        "price": 300,
        "description": "Обновленное описание"
    },
    "categories": [1, 3]
}
```
Пример успешного ответа:
>Магазин успешно обновлен!
## PATCH /api/v1/shops?id=<shop_id> — Частичное обновление данных магазина
Описание: Этот запрос выполняет частичное обновление данных магазина с указанным <shop_id>, позволяя обновить только те поля, которые присутствуют в теле запроса, а также изменить привязанные категории.

Пример запроса:


>PATCH 
>>http://localhost:8080/api/v1/shops?id=3

Тело запроса:

```json
{
    "shop": {
        "name": "Частично обновленный магазин",
        "price": 450
    },
    "categories": ["Категория 2"]
}
```
Параметр id — идентификатор магазина, данные которого нужно обновить.
В теле запроса отправляются:
Объект shop, содержащий поля, которые нужно обновить. Например, можно обновить только name и price, оставив остальные поля без изменений.
Массив categories, включающий новые привязки к категориям (если передан).
Пример успешного ответа:


>Магазин успешно обновлен!

Примечание:
Если поле categories не указано, текущие категории магазина останутся без изменений. Если categories передано как пустой массив, привязки к категориям будут удалены.

Чтобы поменять только категорию,можно отправить в теле запроса только массив с id необходимых категорий. Например:  
```json
  {
        "categories": [1,2]
    }
```
Пример успешного ответа:


>Магазин успешно обновлен!

